{% extends './contest_frame.html' %}
{% block contest_content %}
<h1 class="text-center">
    {{contest_data['title']}}-Scoreboard
</h1>
<style>
th, td{
    text-align: center !important;
}
</style>
<div class="panel panel-default table-responsive">
    <table class="table table-hover table-bordered table-condensed">
        <thead>
            <tr>
                <th id="head-rank">Rank</th>
                <th id="head-user">User</th>
                <th id="head-score">Score</th>
                <th id="head-penalty">Penalty</th>
                {% for id, x in enumerate(data['problems']) %}
                    <th><a href="/groups/{{current_group}}/contests/{{contest_data['id']}}/problems/{{x['id']}}/">{{ chr(id+65) }}</a></th>
                {% end %}
                <th id="head-total">Total att/solve</th>
            </tr>
        </thead>
        <tbody>
            {% for x in data['users'] %}
                <tr id="user_{{x['id']}}">
                    <td data-type="rank"></td>
                    <td>{{x['name']}}</td>
                    <td data-type="score">--</td>
                    <td data-type="penalty">--</td>
                    {% for id, x in enumerate(data['problems']) %}
                        <td data-type="problem_{{chr(id+65)}}">--/--</td>
                    {% end %}
                    <td data-type="total">--/--</td>
                </tr>
            {% end %}
        </tbody>
        <tfoot>
            <tr>
                <td></td>
                <td>First AC</td>
                <td></td>
                <td></td>
                {% for id, x in enumerate(data['problems']) %}
                    <td>--/--</td>
                {% end %}
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td>Total att/solve</td>
                <td></td>
                <td></td>
                {% for id, x in enumerate(data['problems']) %}
                    <td>--/--</td>
                {% end %}
                <td></td>
            </tr>
        </tfoot>
    </table>
</div>
<script>

require(["jquery"], function($){
    function get_scoreboard(){
        $.get("/api/groups/{{current_group}}/contests/{{contest_data['id']}}/scoreboard/", {token: '{{account["token"]}}'}, function(msg){
            msg = msg['msg'];
            score_board = new Object();
            msg['users'].forEach(function(user){
                score_board[user['id']] = new Object();
                msg['problems'].forEach(function(problem, index){
                    score_board[user['id']][problem['id']] = new Object();
                    score_board[user['id']][problem['id']]['try'] = 0;
                    score_board[user['id']][problem['id']]['first_ac_time'] = 0;
                    console.log(score_board[user['id']]);
                });
            });
            msg['submissions'].forEach(function(submission){

                if(score_board[submission['user_id']][submission['problem_id']]['first_ac_time'] == 0){
                    score_board[submission['user_id']][submission['problem_id']]['try'] += 1;
                    if(submission['verdict'] == 1)
                        score_board[submission['user_id']][submission['problem_id']]['first_ac_time'] = 1;
                }
                console.log(submission);
            });
            console.log(score_board);
        }, "json");
    }
    get_scoreboard();
});
</script>
{% end %}
